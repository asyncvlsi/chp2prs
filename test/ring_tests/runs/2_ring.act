/* auto-generated by logic synthesis */
import "2.act";

import syn::ring;
open syn::ring;
open syn;
import "runs/2_expr.act";
open syn::expr;


defproc ring_snk <: snk()
+{
  bd_int<4> x;
  bd<4> l;
  }
{
  refine {
    /* synthesis output */
    
/* start rsyn */
// One Ring ---------------------

// Initial token buffer to initialize ring
elem_c_itb block_1;

// Pipe block for action: l?x
elem_c_ppa_brs_bd block_2;
connect_inchan_to_ctrl<4> conn_z_2;
conn_z_2.ctrl = block_2.zero;
conn_z_2.ch = l;

// Data for action: l?x
capture<5,6,4> latch_x_0;
latch_x_0.go = block_2.data;
latch_x_0.din = l.d;

// Connecting block_1 & block_2
block_2.m1 = block_1.p1;

// Connecting block_2 & block_1
block_1.m1 = block_2.p1;


/* end rsyn */
    
    /* end refine */
  }
  /* end process */
}
defproc ring_src <: src()
+{
  bd<4> r;
  }
{
  refine {
    /* synthesis output */
    
/* start rsyn */

// Pipe block for action: r!0x5
elem_c_paa_brs_bd block_1;
connect_outchan_to_ctrl<4> conn_z_1;
conn_z_1.ch = r;

// Data for action: r!0x5
// output bitwidth: 4 bits


blk_1 inst_1;
delay_line_chan<1> delay_expr_1;
inst_1.out = r.d;
delay_expr_1.m1 = block_1.zero;
delay_expr_1.p1 = conn_z_1.ctrl;
source_brs term_inst_1;
term_inst_1.c = block_1.m1;
sink_brs term_inst_2;
term_inst_2.c = block_1.p1;


/* end rsyn */
    
    /* end refine */
  }
  /* end process */
}
defproc ring_add <: add()
+{
  bd<4> r;
  bd_int<4> x2;
  bd_int<4> x1;
  bd<4> l2;
  bd<4> l1;
  }
{
  refine {
    /* synthesis output */
    
/* start rsyn */
// One Ring ---------------------

// Initial token buffer to initialize ring
elem_c_itb block_1;

// Pipe block for action: l1?x1
elem_c_ppa_brs_bd block_2;
connect_inchan_to_ctrl<4> conn_z_2;
conn_z_2.ctrl = block_2.zero;
conn_z_2.ch = l1;

// Data for action: l1?x1
capture<5,6,4> latch_x1_0;
latch_x1_0.go = block_2.data;
latch_x1_0.din = l1.d;

// Connecting block_1 & block_2
block_2.m1 = block_1.p1;

// Pipe block for action: l2?x2
elem_c_ppa_brs_bd block_3;
connect_inchan_to_ctrl<4> conn_z_3;
conn_z_3.ctrl = block_3.zero;
conn_z_3.ch = l2;

// Data for action: l2?x2
capture<5,6,4> latch_x2_0;
latch_x2_0.go = block_3.data;
latch_x2_0.din = l2.d;

// Connecting block_2 & block_3
block_3.m1 = block_2.p1;

// Pipe block for action: r!x1+x2
elem_c_paa_brs_bd block_4;
connect_outchan_to_ctrl<4> conn_z_4;
conn_z_4.ch = r;

// Data for action: r!x1+x2
// output bitwidth: 4 bits



// typical delay: 423.62ps
blk_2 inst_2;
inst_2.in_2 = latch_x2_0.dout;
inst_2.in_1 = latch_x1_0.dout;
delay_line_chan<11> delay_expr_2;
inst_2.out = r.d;
delay_expr_2.m1 = block_4.zero;
delay_expr_2.p1 = conn_z_4.ctrl;

// Connecting block_3 & block_4
block_4.m1 = block_3.p1;

// Connecting block_4 & block_1
block_1.m1 = block_4.p1;


/* end rsyn */
    
    /* end refine */
  }
  /* end process */
}
defproc ring_testproc <: testproc()
+{
  ring_snk o;
  ring_src i2;
  ring_add a;
  bd<4> X1;
  ring_src i1;
  bd<4> Y;
  bd<4> X2;
  }
{
  /* end process */
}
