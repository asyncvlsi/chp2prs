defproc testproc(chan?(int) X; chan!(int) Y, Z)
{
  int a, b, c, d;
  int i, j;
  int vals[4];

   chp {
     a := 10;
     vals[0] := 0;
     vals[1] := 1;
     vals[2] := 2;
     vals[3] := 3;
     b := 0;
   *[ [ b = 0 -> 
        *[ i < 2 -> j := 0; *[ j < 2 -> X?c; Y!(c+1); 
                                [ c=3 -> d:=4 [] else -> skip ];
                                j := j + 1 ]; 
                               [ d = 0 -> c:=4 [] else -> skip ];
                                i := i + 1]; i := 0; b := 1
      [] b = 1 -> X?c; Y!(c+2); b := 2; i := 0
      [] b = 2 -> *[ X?c; Y!(c+3) <- c > 30 ]; b := 3; (;k:4: Z!vals[k])
      [] b = 3 -> j := 0; *[ j < 2 -> (;k:4: Z!vals[k]); j := j + 1 ]; b := 0; i := 0
       ]
    ]
   }
}
