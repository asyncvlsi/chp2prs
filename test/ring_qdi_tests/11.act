
defproc receiver (chan?(int<2>) A, B; chan!(int<1>) C)
{
    int<2> x, y, z, w;
    int<2> x1, y1, z1;

    chan(int<2>) XS, XR;
    chan(int<2>) YS, YR;
    chan(int<2>) ZS, ZR;

    chp {
        // top_decomp: (
        //     qdi_itb:(x1:=0;*[XS!x1;XR?x1]) 
        //     ,
        //     qdi_itb:(y1:=0;*[YS!y1;YR?y1]) 
        //     ,
        //     qdi_itb:(z1:=0;*[ZS!z1;ZR?z1]) 
        //     ,
        //     (
        //     *[  
        //         XS?x,YS?y,ZS?z;
        //         [ x=0  -> A?y
        //         []else -> B?z
        //         ];
        //         w:=int(y=1 & z=2);
        //         C!w;
        //         x:=x+1;
        //         XR!x,YR!y,ZR!z
        //     ]
        //     )
        // )
            x:=0; y:=0; z:=0; 
            *[  
                [ x=0  -> A?y
                []else -> B?z
                ];
                w:=int(y=1 & z=2);
                C!w;
                x:=x+1
            ]
    }
}

defproc sender (chan!(int<2>) A, B)
{
    chp {
        *[
            A!1; B!2
        ]
    }
}

defproc snk (chan?(int<1>) l)
{
	int<1> x;
	chp{
		*[l?x; log("%d", x)]
	}
}

defproc testproc (chan?(int<2>) X1, X2; chan!(int<1>) Y)
{
  sender s(X1,X2);
  receiver r(X1,X2,Y);
  snk ss(Y);
}
