
defproc receiver (chan?(int<1>) A, B; chan!(int<1>) C)
{
    int<1> x, y, z;
    chp {
        *[ A?x ; B?y; 
			z := int(x=0 & y=1);
			C!z
		 ]
    }
}

defproc sender (chan!(int<1>) A, B)
{
    int<1> x;
    int<1> x1;

    chan(int<1>) XS, XR;

    chp {
        top_decomp: (
            qdi_itb:(x1:=0;*[XS!x1;XR?x1]) 
            ,
            (
            *[
                XS?x;
                [ x=0  -> A!x
                []else -> B!x
                ];
                x:=x+1;
                XR!x
            ]
            )
        )
    }
}

defproc snk (chan?(int<1>) l)
{
	int<1> x;
	chp{
		*[l?x; log("%d", x)]
	}
}

defproc testproc (chan?(int<1>) X1, X2; chan!(int<1>) Y)
{
  sender s(X1,X2);
  receiver r(X1,X2,Y);
  snk ss(Y);
}
